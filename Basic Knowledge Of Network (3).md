## 网络基础知识（三）

-----------------------------------------------

## 以太网(RFC 894)帧格式

![image](http://hbimg.b0.upaiyun.com/f3a5336c2e39dd2e0fa41356c878b40987f6c2ac173e1-DtPzeb_fw658)


	以太网帧中的数据长度规定最小46字节,最大1500字节,ARP和RARP数据包的长度不够46字节,要在后面补填充位(PAD)。
	
	MTU(最大传输单元)：1500称为以太网的最大传输单元，MTU这个概念指数据帧中有效载荷的最大长度,不包括帧首部的长度。
	
	不同的网络类型有不同的MTU,如果一个数据包从以太网路由到拨号链路上,数据包长度大于拨号链路的MTU了,则需要对数据
	包进行分片(fragmentation)。分片在MAC帧上层完成的。

<br>
<br>

## ARP数据报格式

	在网络通讯时,源主机的应用程序知道目的主机的IP地址和端⼜号,却不知道目的主机的硬件地址,而数据包首先是被网卡接收
	到再去处理上层协议的,如果接收到的数据包的硬件地址与本机不符,则直接丢弃。因此在通讯前必须获得目的主机的硬件地
	址。 ARP协议就起到这个作用。

<br>

	ARP（地址解析协议）请求：

	源主机发出ARP请求，询问这个目的IP的硬件地址，并将这个请求广播到本地网段，目的主机接收到广播的ARP请求,发现其中
	的IP地址与本机相符,则发送一个ARP应答数据包给源主机,将自己的硬件地址填写在应答包中。
	
<br>

	ARP缓存表：
	
	每台主机都维护一个ARP缓存表,可以用 arp -a 命令查看。 
	
	缓存表中的表项有过期时间(一般为20分钟),如果20分钟内没有再次使用某个表项,则该表项失效,下次还要发ARP请求来获得
	目的主机的硬件地址。

<br>
	
![image](http://hbimg.b0.upaiyun.com/9280be59399b092c37a72b68bf28c029759e2b56196bf-WXEBdn_fw658)

<br>
<br>


## IP数据报

	IP 数据报的首部长度和数据长度都是可变长的,但总是4字节的整数倍。
	
![image](http://hbimg.b0.upaiyun.com/66fc5c25e7a3213542c1574366d0bfe95564970e1704e-gA7F2i_fw658)


	1.对于IPv4：4位版本字段是4；
	
	2.4位首部长度的数值是以4字节为单位的,最小值为5,也就是说首部长度最小是4x5=20字节,也就是不带任何选项的IP首部,
	 4位能表示的最大值是15,也就是说首部长度最大是60字节；
	 
	3.8位TOS字段有3个位用来指定IP数据报的优先级(目前已经废弃不用),还有4个位表示可选的服务类型(最小延迟、最大呑
	 吐量、最大可靠性、最小成本),还有一个位总是0。
	 
	4.16位总长度是整个数据报(包括IP首部和IP层有效载荷)的字节数。
	
	5.每传一个IP数据报,16位的标识加1,可用于分片和重新组装数据报。
	
	6.3位标志和13位片偏移用于分片。
	
	7.TTL(Time to live)是这样用的:源主机为数据包设定一个生存时间,例如64,每过一个路由器就把该值减1,如果减到0就表
	 示路由已经太长了仍然找不到目的主机的网络,就丢弃该包,因此这个生存时间的单位不是秒,而是跳(hop)。
	 
	8.协议字段指示上层协议是TCP、 UDP、 ICMP还是IGMP。
	
	9.校验和,只校验IP首部,数据的校验由更高层协议负责。
	
	10.IPv4的IP地址长度为32位，IPv6的IP地址长度为128位。
	
<br>
<br>

## UDP段格式

![image](http://hbimg.b0.upaiyun.com/2f2f461f8e3ce0720960b5819d8a82800dfd7737e3a6-VdsSji_fw658)

	发送端：
	
	UDP协议不面向连接,也不保证传输的可靠性,例如: 发送端的UDP协议层只管把应用层传来的数据封装成段交给IP协议层
	就算完成任务了,如果因为网络故障该段无法发到对方,UDP协议层也不会给应用层返回任何错误信息。
	
	
	接收端：
	
	接收端的UDP协议层只管把收到的数据根据端⼜号交给相应的应用程序就算完成任务了,如果发送端发来多个数据包并且
	在网络上经过不同的路由,到达接收端时顺序已经错乱了,UDP协议层也不保证按发送时的顺序交给应用层。
	
	通常接收端的UDP协议层将收到的数据放在一个固定大小的缓冲区中等待应用程序来提取和处理,如果应用程序提取和处
	理的速度很慢,而发送端发送的速度很快,就会丢失数据包,UDP协议层并不报告这种错误。因此,使用UDP协议的应用程序
	必须考虑到这些可能的问题并实现适当的解决方案,例如等待应答、超时重发、为数据包编号、流量控制等。

<br>
<br>

## TCP协议

![image](http://hbimg.b0.upaiyun.com/c8a59f8a6f62b95119ceb75770791d9b6dc41ac3197f4-VibkeU_fw658)

	1.源端口(Source Port)：16位的源端口字段包含初始化通信的端口号。源端口和IP地址 的作用是标识报文的返回地址。
	
	2.目的端口(Destination Port):16位的目的端口字段定义传输的目的。这个端口指明接收方计算机上的应用程序接口。
	
	3.序列号（Sequence Number）:该字段用来标识TCP源端设备向目的端设备发送的字节流，它表示在这个报文段中的第几
	  个数据字节。序列号是一个32位的数。
	  
	4.确认号（Acknowledge Number）：TCP使用32位的确认号字段标识期望收到的下一个段的第一个字节，并声明此前的所
	  有数据已经正确无误地收到，因此，确认号应该是上次已成功收到的数据字节序列号加1。收到确认号的源计算机会知
	  道特定的段已经被收到。确认号的字段只在ACK标志被设置时才有效。

	5.数据偏移（Data Offset）:这个4位字段包括TCP头大小。由于首部可能含有选项内容，因此TCP首部的长度是不确定的。
	  首部长度的单位是32比特或4个八位组。首部长度实际上也指示了数据区在报文段中的起始偏移值。
	
	6.保留（Reserved）:6位置0的字段。为将来定义新的用途保留。
	
	7.URG(Urgent Pointer Field Significant,紧急指针字段标志):
	  表示TCP包的紧急指针字段有效，用来保证TCP连接不被中断，并且督促中间齐备尽快处理这些数据。  
	
	  ACK（Acknowledgement field significant,确认字段标志）: 
	  取1时表示应答字段有效，也即TCP应答号将包含在TCP段中，为0则反之。
	  
	  PSH(Push Function,推功能)：
	  这个标志表示Push操作。所谓Push操作就是指在数据包到达接收端以后，立即送给应用程序，而不是在缓冲区中排队。
	  
	  RST（Reset the connection,重置连接）：
	  这个标志表示感谢连接复位请求，用来复位那些产生错误的连接，也被用来拒绝错误和非法的数据包。  
	  
	  SYN（Synchronize sequence numbers,同步序列号）:
	  表示同步序号，用来建立连接。
	  
	  FIN（No more data from sender）:
	  表示发送端已经发送到数据末尾，数据传送完成，发送FIN标志位的TCP段，连接将被断开。
	  
	8.窗口（Window）:目的主机使用16位的窗口字段告诉源主机它期望每次收到的数据通的字节数。
	
	9.校验和（Checksum）:TCP头包括16位的校验和字段用于错误检查。源主机基于部分IP头信息，TCP头和数据内容计算一个
	  校验和，目的主机也要进行相同的计算，如果收到的内容没有错误过，两个计算应该完全一样，从而证明数据的有效性。
	
	10.紧急指针（Urgent Pointer）:紧急指针字段是一个可选的16位指针，指向段内的最后一个字节位置，这个字段只在URG
	   标志被设置时才有效。
	 
	11.选项（Option）:至少1字节的可变长字段，标识哪个选项（如果有的话）有效。如果没有选项，这个字节等于0,说明选
	   项的结束。这个字节等于1表示无需再有操作；等于2表示下四个字节包括源机器的最大长度(Maximum Segment Size,MSS)。

	

<br>
<br>













	
	
	













