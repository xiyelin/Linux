## 网络基础知识（三）

-----------------------------------------------

## 以太网(RFC 894)帧格式

![image](http://hbimg.b0.upaiyun.com/f3a5336c2e39dd2e0fa41356c878b40987f6c2ac173e1-DtPzeb_fw658)


	以太网帧中的数据长度规定最小46字节,最大1500字节,ARP和RARP数据包的长度不够46字节,要在后面补填充位(PAD)。
	
	MTU(最大传输单元)：1500称为以太网的最大传输单元，MTU这个概念指数据帧中有效载荷的最大长度,不包括帧首部的长度。
	
	不同的网络类型有不同的MTU,如果一个数据包从以太网路由到拨号链路上,数据包长度大于拨号链路的MTU了,则需要对数据
	包进行分片(fragmentation)。分片在MAC帧上层完成的。

<br>
<br>

## ARP数据报格式

	在网络通讯时,源主机的应用程序知道目的主机的IP地址和端⼜号,却不知道目的主机的硬件地址,而数据包首先是被网卡接收
	到再去处理上层协议的,如果接收到的数据包的硬件地址与本机不符,则直接丢弃。因此在通讯前必须获得目的主机的硬件地
	址。 ARP协议就起到这个作用。

<br>

	ARP（地址解析协议）请求：

	源主机发出ARP请求，询问这个目的IP的硬件地址，并将这个请求广播到本地网段，目的主机接收到广播的ARP请求,发现其中
	的IP地址与本机相符,则发送一个ARP应答数据包给源主机,将自己的硬件地址填写在应答包中。
	
<br>

	ARP缓存表：
	
	每台主机都维护一个ARP缓存表,可以用 arp -a 命令查看。 
	
	缓存表中的表项有过期时间(一般为20分钟),如果20分钟内没有再次使用某个表项,则该表项失效,下次还要发ARP请求来获得
	目的主机的硬件地址。

<br>
	
![image](http://hbimg.b0.upaiyun.com/9280be59399b092c37a72b68bf28c029759e2b56196bf-WXEBdn_fw658)

<br>
<br>


## IP数据报

	IP 数据报的首部长度和数据长度都是可变长的,但总是4字节的整数倍。
	
![image](http://hbimg.b0.upaiyun.com/66fc5c25e7a3213542c1574366d0bfe95564970e1704e-gA7F2i_fw658)

<br>

	1.对于IPv4：4位版本字段是4；
	
	2.4位首部长度的数值是以4字节为单位的,最小值为5,也就是说首部长度最小是4x5=20字节,也就是不带任何选项的IP首部,
	 4位能表示的最大值是15,也就是说首部长度最大是60字节；
	 
	3.8位TOS字段有3个位用来指定IP数据报的优先级(目前已经废弃不用),还有4个位表示可选的服务类型(最小延迟、最大呑
	 吐量、最大可靠性、最小成本),还有一个位总是0。
	 
	4.16位总长度是整个数据报(包括IP首部和IP层有效载荷)的字节数。
	
	5.每传一个IP数据报,16位的标识加1,可用于分片和重新组装数据报。
	
	6.3位标志和13位片偏移用于分片。
	
	7.TTL(Time to live)是这样用的:源主机为数据包设定一个生存时间,例如64,每过一个路由器就把该值减1,如果减到0就表
	 示路由已经太长了仍然找不到目的主机的网络,就丢弃该包,因此这个生存时间的单位不是秒,而是跳(hop)。
	 
	8.协议字段指示上层协议是TCP、 UDP、 ICMP还是IGMP。
	
	9.校验和,只校验IP首部,数据的校验由更高层协议负责。
	
	10.IPv4的IP地址长度为32位，IPv6的IP地址长度为128位。
	
<br>
<br>














